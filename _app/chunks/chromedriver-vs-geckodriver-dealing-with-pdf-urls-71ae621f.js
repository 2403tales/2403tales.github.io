import{S as Is,i as Ls,s as Hs,C as Zn,w as Os,x as Ts,y as Rs,z as Ss,A as Ps,q as As,o as Ms,B as Us,P as Es,e as p,t,k as d,c,a as l,h as e,d as s,m as k,b as hn,g as i,I as a,M as $s}from"./vendor-e6930037.js";import{P as qs}from"./_posts-0ccc0035.js";function Bs(C){let r,m,v,_,u,f,w,$,fn,wn,q,mn,Z,I,vn,nn,x,xs=`<code class="language-python"><span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>chrome<span class="token punctuation">.</span>options <span class="token keyword">import</span> Options

options <span class="token operator">=</span> Options<span class="token punctuation">(</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--headless"</span><span class="token punctuation">)</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token string">'./chromedriver'</span><span class="token punctuation">,</span> options<span class="token operator">=</span>options<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">save_pdf</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">:</span>
	response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
	  f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>urls<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
		<span class="token comment"># Navigate browser to URL containing relevant button</span>
		driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">try</span><span class="token punctuation">:</span>
		<span class="token comment"># If the button exists, click it</span>
	  x <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token triple-quoted-string string">'''//input[@value='Click here']'''</span><span class="token punctuation">)</span>
	  x<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">except</span> NoSuchElementException<span class="token punctuation">:</span>
		<span class="token comment"># If it doesn't, we're on PDF page</span>
    <span class="token keyword">pass</span>
	<span class="token comment"># Finally, save the PDF at the current URL to a file named xxxx.pdf</span>
	save_pdf<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>current_url<span class="token punctuation">,</span> <span class="token string">'xxxx.pdf'</span><span class="token punctuation">)</span></code>`,sn,L,_n,an,g,gn,B,yn,bn,j,Pn,En,tn,y,xn,G,Dn,Fn,N,Cn,In,en,b,Ln,W,Hn,On,z,Tn,Rn,on,h,Sn,X,An,Mn,J,Un,$n,K,qn,Bn,Q,jn,Gn,pn,H,Nn,cn,P,Wn,V,zn,Xn,Y,Jn,Kn,ln,D,Ds=`<code class="language-python"><span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>firefox<span class="token punctuation">.</span>options <span class="token keyword">import</span> Options <span class="token comment"># This changed</span>

options <span class="token operator">=</span> Options<span class="token punctuation">(</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--headless"</span><span class="token punctuation">)</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span><span class="token string">'./geckodriver'</span><span class="token punctuation">,</span> options<span class="token operator">=</span>options<span class="token punctuation">)</span> <span class="token comment"># This changed</span>

<span class="token keyword">def</span> <span class="token function">save_pdf</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">:</span>
	response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
	  f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>urls<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
		<span class="token comment"># Navigate browser to URL containing relevant button</span>
		driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">try</span><span class="token punctuation">:</span>
		<span class="token comment"># If the button exists, click it</span>
	  x <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token triple-quoted-string string">'''//input[@value='Click here']'''</span><span class="token punctuation">)</span>
	  x<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">except</span> NoSuchElementException<span class="token punctuation">:</span>
		<span class="token comment"># If it doesn't, we're on PDF page</span>
    <span class="token keyword">pass</span>
	<span class="token comment"># Finally, save the PDF at the current URL to a file named xxxx.pdf</span>
	save_pdf<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>current_url<span class="token punctuation">,</span> <span class="token string">'xxxx.pdf'</span><span class="token punctuation">)</span></code>`,rn,O,Qn,un,T,Vn,dn,R,F,Yn;return{c(){r=p("h2"),m=t("Background"),v=d(),_=p("p"),u=t("Recently, I was working on a simple scraping task. I had to write a program that goes through a bunch of URLs and for every URL,"),f=d(),w=p("ul"),$=p("li"),fn=t("Click on a button that redirects to a PDF"),wn=d(),q=p("li"),mn=t("Download the final PDF"),Z=d(),I=p("p"),vn=t("Here\u2019s the piece of code I was using"),nn=d(),x=p("pre"),sn=d(),L=p("h2"),_n=t("Problem Statement"),an=d(),g=p("p"),gn=t("The code is straightforward, and it worked fine when the headless mode was off. However, the moment headless mode was turned on, something spooky started to happen. Plain HTML pages containing the "),B=p("code"),yn=t("Click here"),bn=t(" button were being downloaded instead of PDFs. Given this fact, one might conclude that "),j=p("code"),Pn=t("x.click()"),En=t(" was not executing properly."),tn=d(),y=p("p"),xn=t("But astonishingly, PDFs were getting downloaded, just with some gibberish names (like "),G=p("code"),Dn=t("3487938nfhabalkvt.pdf"),Fn=t("). I was confused as fuck, because if my "),N=p("code"),Cn=t("save_pdf"),In=t(" module was downloading the HTML pages, who tf was downloading the PDFs??"),en=d(),b=p("p"),Ln=t("And after 8 hours of debugging and researching, I concluded that "),W=p("code"),Hn=t("chromedriver"),On=t(" was the culprit! It was the one downloading the PDFs. The next question was why? And the closest answer I could find after hours of research was that "),z=p("code"),Tn=t("chromedriver"),Rn=t(" doesn\u2019t support opening the PDFs, and hence the default behavior is to download the PDF whenever it encounters a link containing a PDF."),on=d(),h=p("p"),Sn=t("And the worst part, "),X=p("code"),An=t("driver.current_url"),Mn=t(" still points to the link which redirects you to the PDF, not the actual PDF link \u{1F616}. So that\u2019s why, when "),J=p("code"),Un=t("save_pdf"),$n=t(" was getting called, it actually downloaded the HTML page, and since "),K=p("code"),qn=t("x.click()"),Bn=t(" happened, the "),Q=p("code"),jn=t("chromedriver"),Gn=t(" was downloading the PDFs separately, and assigning the name which it got from the server."),pn=d(),H=p("h2"),Nn=t("Solution"),cn=d(),P=p("p"),Wn=t("On a hunch, I just changed "),V=p("code"),zn=t("chromedriver"),Xn=t(" to "),Y=p("code"),Jn=t("geckodriver"),Kn=t(" (Webdriver for Firefox), and everything worked. Here\u2019s the new snippet which worked"),ln=d(),D=p("pre"),rn=d(),O=p("h2"),Qn=t("Related links"),un=d(),T=p("p"),Vn=t("There were tons of links that I visited, but this one gives you enough information to diagnose the problem"),dn=d(),R=p("p"),F=p("a"),Yn=t("https://github.com/puppeteer/puppeteer/issues/1872"),this.h()},l(n){r=c(n,"H2",{});var o=l(r);m=e(o,"Background"),o.forEach(s),v=k(n),_=c(n,"P",{});var ss=l(_);u=e(ss,"Recently, I was working on a simple scraping task. I had to write a program that goes through a bunch of URLs and for every URL,"),ss.forEach(s),f=k(n),w=c(n,"UL",{});var kn=l(w);$=c(kn,"LI",{});var as=l($);fn=e(as,"Click on a button that redirects to a PDF"),as.forEach(s),wn=k(kn),q=c(kn,"LI",{});var ts=l(q);mn=e(ts,"Download the final PDF"),ts.forEach(s),kn.forEach(s),Z=k(n),I=c(n,"P",{});var es=l(I);vn=e(es,"Here\u2019s the piece of code I was using"),es.forEach(s),nn=k(n),x=c(n,"PRE",{class:!0});var Fs=l(x);Fs.forEach(s),sn=k(n),L=c(n,"H2",{});var os=l(L);_n=e(os,"Problem Statement"),os.forEach(s),an=k(n),g=c(n,"P",{});var S=l(g);gn=e(S,"The code is straightforward, and it worked fine when the headless mode was off. However, the moment headless mode was turned on, something spooky started to happen. Plain HTML pages containing the "),B=c(S,"CODE",{});var ps=l(B);yn=e(ps,"Click here"),ps.forEach(s),bn=e(S," button were being downloaded instead of PDFs. Given this fact, one might conclude that "),j=c(S,"CODE",{});var cs=l(j);Pn=e(cs,"x.click()"),cs.forEach(s),En=e(S," was not executing properly."),S.forEach(s),tn=k(n),y=c(n,"P",{});var A=l(y);xn=e(A,"But astonishingly, PDFs were getting downloaded, just with some gibberish names (like "),G=c(A,"CODE",{});var ls=l(G);Dn=e(ls,"3487938nfhabalkvt.pdf"),ls.forEach(s),Fn=e(A,"). I was confused as fuck, because if my "),N=c(A,"CODE",{});var is=l(N);Cn=e(is,"save_pdf"),is.forEach(s),In=e(A," module was downloading the HTML pages, who tf was downloading the PDFs??"),A.forEach(s),en=k(n),b=c(n,"P",{});var M=l(b);Ln=e(M,"And after 8 hours of debugging and researching, I concluded that "),W=c(M,"CODE",{});var rs=l(W);Hn=e(rs,"chromedriver"),rs.forEach(s),On=e(M," was the culprit! It was the one downloading the PDFs. The next question was why? And the closest answer I could find after hours of research was that "),z=c(M,"CODE",{});var us=l(z);Tn=e(us,"chromedriver"),us.forEach(s),Rn=e(M," doesn\u2019t support opening the PDFs, and hence the default behavior is to download the PDF whenever it encounters a link containing a PDF."),M.forEach(s),on=k(n),h=c(n,"P",{});var E=l(h);Sn=e(E,"And the worst part, "),X=c(E,"CODE",{});var ds=l(X);An=e(ds,"driver.current_url"),ds.forEach(s),Mn=e(E," still points to the link which redirects you to the PDF, not the actual PDF link \u{1F616}. So that\u2019s why, when "),J=c(E,"CODE",{});var ks=l(J);Un=e(ks,"save_pdf"),ks.forEach(s),$n=e(E," was getting called, it actually downloaded the HTML page, and since "),K=c(E,"CODE",{});var hs=l(K);qn=e(hs,"x.click()"),hs.forEach(s),Bn=e(E," happened, the "),Q=c(E,"CODE",{});var fs=l(Q);jn=e(fs,"chromedriver"),fs.forEach(s),Gn=e(E," was downloading the PDFs separately, and assigning the name which it got from the server."),E.forEach(s),pn=k(n),H=c(n,"H2",{});var ws=l(H);Nn=e(ws,"Solution"),ws.forEach(s),cn=k(n),P=c(n,"P",{});var U=l(P);Wn=e(U,"On a hunch, I just changed "),V=c(U,"CODE",{});var ms=l(V);zn=e(ms,"chromedriver"),ms.forEach(s),Xn=e(U," to "),Y=c(U,"CODE",{});var vs=l(Y);Jn=e(vs,"geckodriver"),vs.forEach(s),Kn=e(U," (Webdriver for Firefox), and everything worked. Here\u2019s the new snippet which worked"),U.forEach(s),ln=k(n),D=c(n,"PRE",{class:!0});var Cs=l(D);Cs.forEach(s),rn=k(n),O=c(n,"H2",{});var _s=l(O);Qn=e(_s,"Related links"),_s.forEach(s),un=k(n),T=c(n,"P",{});var gs=l(T);Vn=e(gs,"There were tons of links that I visited, but this one gives you enough information to diagnose the problem"),gs.forEach(s),dn=k(n),R=c(n,"P",{});var ys=l(R);F=c(ys,"A",{href:!0,rel:!0});var bs=l(F);Yn=e(bs,"https://github.com/puppeteer/puppeteer/issues/1872"),bs.forEach(s),ys.forEach(s),this.h()},h(){hn(x,"class","language-python"),hn(D,"class","language-python"),hn(F,"href","https://github.com/puppeteer/puppeteer/issues/1872"),hn(F,"rel","nofollow")},m(n,o){i(n,r,o),a(r,m),i(n,v,o),i(n,_,o),a(_,u),i(n,f,o),i(n,w,o),a(w,$),a($,fn),a(w,wn),a(w,q),a(q,mn),i(n,Z,o),i(n,I,o),a(I,vn),i(n,nn,o),i(n,x,o),x.innerHTML=xs,i(n,sn,o),i(n,L,o),a(L,_n),i(n,an,o),i(n,g,o),a(g,gn),a(g,B),a(B,yn),a(g,bn),a(g,j),a(j,Pn),a(g,En),i(n,tn,o),i(n,y,o),a(y,xn),a(y,G),a(G,Dn),a(y,Fn),a(y,N),a(N,Cn),a(y,In),i(n,en,o),i(n,b,o),a(b,Ln),a(b,W),a(W,Hn),a(b,On),a(b,z),a(z,Tn),a(b,Rn),i(n,on,o),i(n,h,o),a(h,Sn),a(h,X),a(X,An),a(h,Mn),a(h,J),a(J,Un),a(h,$n),a(h,K),a(K,qn),a(h,Bn),a(h,Q),a(Q,jn),a(h,Gn),i(n,pn,o),i(n,H,o),a(H,Nn),i(n,cn,o),i(n,P,o),a(P,Wn),a(P,V),a(V,zn),a(P,Xn),a(P,Y),a(Y,Jn),a(P,Kn),i(n,ln,o),i(n,D,o),D.innerHTML=Ds,i(n,rn,o),i(n,O,o),a(O,Qn),i(n,un,o),i(n,T,o),a(T,Vn),i(n,dn,o),i(n,R,o),a(R,F),a(F,Yn)},p:$s,d(n){n&&s(r),n&&s(v),n&&s(_),n&&s(f),n&&s(w),n&&s(Z),n&&s(I),n&&s(nn),n&&s(x),n&&s(sn),n&&s(L),n&&s(an),n&&s(g),n&&s(tn),n&&s(y),n&&s(en),n&&s(b),n&&s(on),n&&s(h),n&&s(pn),n&&s(H),n&&s(cn),n&&s(P),n&&s(ln),n&&s(D),n&&s(rn),n&&s(O),n&&s(un),n&&s(T),n&&s(dn),n&&s(R)}}}function js(C){let r,m;const v=[C[0],ns];let _={$$slots:{default:[Bs]},$$scope:{ctx:C}};for(let u=0;u<v.length;u+=1)_=Zn(_,v[u]);return r=new qs({props:_}),{c(){Os(r.$$.fragment)},l(u){Ts(r.$$.fragment,u)},m(u,f){Rs(r,u,f),m=!0},p(u,[f]){const w=f&1?Ss(v,[f&1&&Ps(u[0]),f&0&&Ps(ns)]):{};f&2&&(w.$$scope={dirty:f,ctx:u}),r.$set(w)},i(u){m||(As(r.$$.fragment,u),m=!0)},o(u){Ms(r.$$.fragment,u),m=!1},d(u){Us(r,u)}}}const ns={title:"Chromedriver v/s GeckoDriver: Dealing with PDF URLs",date:"11 August, 2022",categories:["Web Scraping","Selenium","engineering","data"],description:"How PDFs are handled by Chromedriver and Geckodriver in headless mode",author:"Prakash"};function Gs(C,r,m){return C.$$set=v=>{m(0,r=Zn(Zn({},r),Es(v)))},r=Es(r),[r]}class Ns extends Is{constructor(r){super();Ls(this,r,Gs,js,Hs,{})}}var Xs=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Ns,metadata:ns});export{Ns as C,Xs as _,ns as m};
